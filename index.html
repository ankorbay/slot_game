<!doctype html>
<html>
    <head>
    <meta charset="utf-8">
    <title>Hello World</title>
    </head>
    <script src="Scripts/pixi/pixi.min.js"></script>
    <script src="node_modules/howler/src/howler.core.js"></script>
    <script src="node_modules/pixi-timeout/index.js"></script>
    <body>
        <script type="text/javascript">
        
            let type = "WebGL"
            if(!PIXI.utils.isWebGLSupported()){
            type = "canvas"
            }

            let isSymbolsSpawned = false;

            let i = 14;

            const sound = new Howl({
                src: ["Assets/sounds/Start_Button.mp3"],
                autoplay: true,
                loop: false,
            });

            const reel1 = new Howl({
                src: ["Assets/sounds/Reel_Stop_1.mp3"],
                autoplay: true,
                loop: false,
            });

            const reel2 = new Howl({
                src: ["Assets/sounds/Reel_Stop_2.mp3"],
                autoplay: true,
                loop: false,
            });

            const reel3 = new Howl({
                src: ["Assets/sounds/Reel_Stop_3.mp3"],
                autoplay: true,
                loop: false,
            });

            const reel4 = new Howl({
                src: ["Assets/sounds/Reel_Stop_4.mp3"],
                autoplay: true,
                loop: false,
            });

            const reel5 = new Howl({
                src: ["Assets/sounds/Reel_Stop_5.mp3"],
                autoplay: true,
                loop: false,
            });

            const app = new PIXI.Application({ backgroundColor: 0x1099bb });
            document.body.appendChild(app.view);

            const data = {
                1: [0,0],
                2: [0,0],
                3: [0,0],
                4: [0,0],
                5: [0,0],
                6: [0,0],
                7: [0,0],
                8: [0,0],
                9: [0,0],
                10: [0,0],
                11: [0,0],
                12: [0,0],
                13: [0,0],
                14: [0,0],
                15: [0,0]
            };

            app.loader
                .add('symbol_1', 'Assets/images/symbols/symbol_1.png')
                .add('symbol_2', 'Assets/images/symbols/symbol_2.png')
                .add('symbol_3', 'Assets/images/symbols/symbol_3.png')
                .add('symbol_4', 'Assets/images/symbols/symbol_4.png')
                .add('symbol_5', 'Assets/images/symbols/symbol_5.png')
                .add('symbol_6', 'Assets/images/symbols/symbol_6.png')
                .add('symbol_7', 'Assets/images/symbols/symbol_7.png')
                .add('symbol_8', 'Assets/images/symbols/symbol_8.png')
                .add('btn_spin_disabled', 'Assets/images/ui/btn_spin_disabled.png')
                .add('btn_spin_hover', 'Assets/images/ui/btn_spin_hover.png')
                .add('btn_spin_normal', 'Assets/images/ui/btn_spin_normal.png')
                .add('btn_spin_pressed', 'Assets/images/ui/btn_spin_pressed.png')
                .load(onAssetsLoaded);

            const REEL_WIDTH = 160;
            const SYMBOL_SIZE = 150;

            const DIST_BTW_SYMBOLS_SPAWNED = 30.;
            const DIST_BTW_ROWS_SPAWNED = 120.;

            function randomInt(min, max){
                return Math.round(min - 0.5 + Math.random() * (max - min + 1));
            };

            const symbolsSpawned = [];
            const symbols = [];

            const slotTextures = [
                    PIXI.Texture.from('Assets/images/symbols/symbol_1.png'),
                    PIXI.Texture.from('Assets/images/symbols/symbol_2.png'),
                    PIXI.Texture.from('Assets/images/symbols/symbol_3.png'),
                    PIXI.Texture.from('Assets/images/symbols/symbol_4.png'),
                    PIXI.Texture.from('Assets/images/symbols/symbol_5.png'),
                    PIXI.Texture.from('Assets/images/symbols/symbol_6.png'),
                    PIXI.Texture.from('Assets/images/symbols/symbol_7.png'),
                    PIXI.Texture.from('Assets/images/symbols/symbol_8.png')
                ];

            symbols.push(symbol1,symbol2,symbol3,symbol4,symbol5,symbol6,symbol7,symbol8);

            function spawnSymbol(posx,posy){
                let i = randomInt(0,7);

                const symbol = new PIXI.Sprite(slotTextures[Math.floor(Math.random() * slotTextures.length)]);

                symbol.scale.x = symbol.scale.y = 0.7;
                symbol.x = posx;
                symbol.y = posy;

                symbolsSpawned.push(symbol);

                app.stage.addChild(symbol);
            }

            function onAssetsLoaded() {
     
                for (let x = 0; x < 5; x++){
                    for (let y = 0; y < 3; y++){
                        let posx = x * 160;
                        let posy = 10 + y * 160;
                        spawnSymbol(posx,posy);
                    }
                }

                const textureButtonNormal = PIXI.Texture.from('Assets/images/ui/btn_spin_normal.png');
                const textureButtonHover = PIXI.Texture.from('Assets/images/ui/btn_spin_hover.png');
                const textureButtonPressed = PIXI.Texture.from('Assets/images/ui/btn_spin_pressed.png');
                const textureButtonDisabled = PIXI.Texture.from('Assets/images/ui/btn_spin_disabled.png');

                const button = new PIXI.Sprite(textureButtonNormal);

                button.width = 100;
                button.height = 100;
                button.x = 350;
                button.y = 500;

                button.interactive = true;
                button.buttonMode = true;

                button
                    .on('mousedown', onButtonDown)
                    .on('mouseover', onButtonOver)
                    .on('mouseout', onButtonOut)

                app.stage.addChild(button);

                button.addListener('pointerdown', () => {
                    sound.play();
                    if(isSymbolsSpawned){
                        animate2();
                    } else {
                        animate1();
                    }
                });
                
                
                function animate1(){
                    if (i == -1) i = 14;
                    symbolsSpawned[i].position.y += 5.;
                    
                    
                    
                    // PIXI.setTimeout(0.01,animate1);
                    requestAnimationFrame(animate1);
                }

                function animate2(){
                    
                }

                function onButtonOut() {
                    this.isOut = true;
                    this.texture = textureButtonNormal;
                }
                
                function onButtonOver() {
                    this.isOver = true;
                    if (this.isdown) {
                        return;
                    } else {
                        this.texture = textureButtonHover; 
                    }
                }

                function onButtonDown() {
                    this.texture = textureButtonPressed;
                    this.isdown = true;
                }

                app.ticker.add((delta) => {
                    
                });
            }
        </script>
    </body>
</html>